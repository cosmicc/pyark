#!/usr/bin/python3

import threading
import subprocess
import argparse, sqlite3
from configparser import ConfigParser
from datetime import datetime
from datetime import time as dt
import time

configfile = '/home/ark/pyark.cfg'

class ExtConfigParser(ConfigParser):
    def getlist(self, section, option):
        value = self.get(section, option)
        return list(filter(None, (x.strip() for x in value.split(','))))

    def getlistint(self, section, option):
        return [int(x) for x in self.getlist(section, option)]

config = ExtConfigParser()
config.read(configfile)

sharedpath = config.get('general', 'shared')

now = time.time()

sqldb = f'{sharedpath}/db/pyark.db'
statdb = f'{sharedpath}/db/stats.db'

conn = sqlite3.connect(statdb)
c = conn.cursor()

##delete the admin account from db
#c.execute('DELETE from players WHERE steamid = 76561198408657294')

#c.execute('DELETE from players WHERE playername = "newplayer"')
#c.execute('UPDATE instances SET arkserverslink = "https://ark-servers.net/server/147631" WHERE name = "ragnarok"')
#c.execute('CREATE TABLE IF NOT EXISTS auctions (steamid TEXT, date TEXT, Type TEXT, name TEXT, sellingclass TEXT, quantity TEXT, askingclass TEXT, askingamount TEXT, tamedname TEXT, baselevel INTEGER, extrlevel INTEGER, level INTEGER, gender TEXT, quality INTEGER, rating REAL, armor REAL, durability REAL, damage REAL, blueprint TEXT)')
#c.execute('ALTER TABLE instances ADD COLUMN battlemetricslink TEXT')
#c.execute('CREATE TABLE lotteryinfo (id INTEGER PRIMARY KEY AUTOINCREMENT, type INTEGER, payoutitem TEXT, timestamp TEXT, buyinpoints INTEGER, lengthdays INTEGER, players INTEGER, winner TEXT)')
#c.execute('CREATE TABLE lotterydeposits (steamid TEXT, playername TEXT, timestamp TEXT, points INTEGER)')
#c.execute('DELETE FROM lotteryinfo WHERE winner = "temp"')
#c.execute('UPDATE instances SET arkserverkey = "6TO5zDDQk9uiywI9aJp9IYjmZmNHZn98DzE" WHERE name = "ragnarok"')
#c.execute('DROP TABLE globalbuffer')
#c.execute('INSERT INTO lotterydeposits (steamid,playername,timestamp,points,givetake) VALUES ("76561198408657294","admin","12500000","5","0")')
#c.execute('PRAGMA table_info(players)')
#c.execute('UPDATE players SET firstseen = ? WHERE steamid = ?', (now,'76561198028548947'))
conn.commit()
c.execute('SELECT * from ragnarok')
alldata = c.fetchall()
ap = []
for row in alldata:
    print(row)
    #c.execute(f'UPDATE players SET homeserver = ? WHERE steamid = ?', (row[3],row[0]))
#conn.commit()
c.close()
conn.close()
