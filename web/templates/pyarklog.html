<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500,700&display=swap&subset=latin-ext" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/logger.css') }}"/>
<script src="{{ url_for('static', filename='js/jquery-3.3.1.min.js') }}"></script>
<script src="https://cdn.socket.io/socket.io-1.0.0.js"></script>
<script>
    var pageLoader = setInterval(function(){
            $("#dashboard").load(" #dashboard");
            starttimer();
        }, 30000);
</script>
<script>
    $(document).ready(function(){
    //connect to the socket server.
    var socket = io.connect('http://' + document.domain + ':' + location.port + '/logstream');
    $('textarea').empty()
    socket.on('logline', function(msg) {
        //console.log(msg.line);
        $('#log').append(msg.line + '<br>');
        $('#logbox').scrollTop($('#logbox')[0].scrollHeight);
    });
    socket.on('chatline', function(msg) {
        //console.log("log line:" + msg.line);
        $('#chat').append(msg.line + '<br>');
        $('#chatbox').scrollTop($('#chatbox')[0].scrollHeight);
    });
    $('#localchat').keypress(function(e) {
    if (e.which == 13)
    {
        var lc = $('#localchat').val();
        $('#localchat').val("");
        console.log(lc)
        var lcjson = new Object();
        lcjson.chatline = lc
        var jsonstring = JSON.stringify(lcjson)
        $.post('/api/serverchat', lcjson, function(data, status) {
               console.log(`${data} and status ${status}`)
               }) 
     }       
});

});
</script>

    {% if current_user.has_role('admin') %}
    <body>
    <div id="toplevel" class="toplevel">
        <div id="dashboard" class="dashboard">
            <div id="playercounts" class="playercounts"></div>
            <div id="servers" class="servers">
                 {% for instance in instances %}
                 {% if not ui_isinstanceup(instance) %}
                 <a href="/serverinfo/{{ instance }}" style="color: #FFFFFF; text-decoration: none;"><button class="serverbutton has-background-danger" style="color: #FFFFFF">{{ instance.capitalize() }}</button></a>
                 {% elif ui_isinrestart(instance) %}
                 <a href="/serverinfo/{{ instance }}" style="color: #000000; text-decoration: none;"><button class="serverbutton has-background-warning">{{ instance.capitalize() }}&nbsp;&nbsp;{{ ui_getplayersonline(instance, fmt='count') }}&nbsp;&nbsp;({{ ui_getrestartleft(instance) }})</button></a>
                 {% elif not ui_iscurrentconfig(instance) %}
                 <a href="/serverinfo/{{ instance }}" style="color: #FFFFFF; text-decoration: none;"><button class="serverbutton has-background-info" style="color: #FFFFFF">{{ instance.capitalize() }}&nbsp;&nbsp;{{ ui_getplayersonline(instance, 'count') }}</button></a>
                 {% else %}
                 <a href="/serverinfo/{{ instance }}" style="color: #FFFFFF; text-decoration: none;"><button class="serverbutton has-background-success" style="color: #FFFFFF">{{ instance.capitalize() }}&nbsp;&nbsp;{{ ui_getplayersonline(instance, 'count') }}</button></a>
                {% endif %}
                {% endfor %}
            </div>    
            <div id="onlineplayers" class="onlineplayers">{{ui_getplayersonline('all', 'count')}}</div>
            <div id="playercounts" class="playercounts">{{ ui_getdailyplayercount() }}<br>{{ ui_getweeklyplayercount() }}<br>{{ ui_getmonthlyplayercount() }}</div>
        </div>
    <br>
       <div id="logbox" class="logbox">
          <div id="log" class="log">
          </div>
       </div>
    <br>
       <div id="chatcombined" class="chatcombined">
          <div id="chatbox" class="chatbox">
             <div id="chat" class="chat">
             </div>
          </div>
          <div class="chatinput">  
             <input id="localchat" class="input" type="text" placeholder="@all">
          </div>   
       </div>
    </div>
    </body>
    {% endif %}
